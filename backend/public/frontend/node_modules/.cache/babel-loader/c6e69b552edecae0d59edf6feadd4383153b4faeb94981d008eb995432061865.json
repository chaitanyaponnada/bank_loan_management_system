{"ast":null,"code":"import React,{useState}from'react';import'./Payment.css';import Modal from'../Modal/Modal';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API_URL='http://localhost:3001/api/v1';function Payment(){const[formData,setFormData]=useState({loan_id:'',amount:'',payment_type:'EMI'});const[error,setError]=useState('');const[isLoading,setIsLoading]=useState(false);const[isModalOpen,setIsModalOpen]=useState(false);const[modalContent,setModalContent]=useState({title:'',body:null});const handleChange=e=>{const{name,value}=e.target;setFormData(prev=>({...prev,[name]:value}));};const closeModalAndReset=()=>{setIsModalOpen(false);};const handleSubmit=async e=>{e.preventDefault();setError('');if(!formData.loan_id.trim()||!formData.amount.trim()){setError('Loan ID and Amount are required.');return;}setIsLoading(true);try{const response=await fetch(`${API_URL}/loans/${formData.loan_id}/payments`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({amount:formData.amount,payment_type:formData.payment_type})});const data=await response.json();if(!response.ok){if(data.error&&data.error.toLowerCase().includes('loan not found')){setModalContent({title:\"Invalid Loan ID\",body:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"The Loan ID \",/*#__PURE__*/_jsx(\"strong\",{children:formData.loan_id}),\" is not associated with any active loan.\"]}),/*#__PURE__*/_jsx(\"p\",{children:\"Please check the ID and try again.\"})]})});setIsModalOpen(true);}else{throw new Error(data.error||'Failed to record payment.');}}else{if(data.loan_closed){if(parseFloat(data.overpaid_amount)>0){setModalContent({title:\"Loan Closed & Refund Due\",body:/*#__PURE__*/_jsxs(\"p\",{children:[\"The loan for \",data.customer_name,\" is fully paid. An overpayment of \\u20B9\",parseFloat(data.overpaid_amount).toFixed(2),\" will be refunded.\"]})});}else{setModalContent({title:\"Loan Closed!\",body:/*#__PURE__*/_jsxs(\"p\",{children:[\"Congratulations, \",data.customer_name,\"! This loan has been fully paid off.\"]})});}}else{setModalContent({title:\"Payment Successful\",body:/*#__PURE__*/_jsxs(\"p\",{children:[\"Payment of \\u20B9\",parseFloat(formData.amount).toFixed(2),\" for \",data.customer_name,\" was successful. The new remaining balance is \\u20B9\",parseFloat(data.remaining_balance).toFixed(2),\".\"]})});}setIsModalOpen(true);setFormData({loan_id:'',amount:'',payment_type:'EMI'});}}catch(err){setError(err.message);}finally{setIsLoading(false);}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Modal,{isOpen:isModalOpen,onClose:closeModalAndReset,title:modalContent.title,children:modalContent.body}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"form-container payment-container\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"component-title\",children:\"Record a Payment\"}),/*#__PURE__*/_jsx(\"p\",{className:\"component-subtitle\",children:\"Submit an EMI or a lump sum amount for an active loan.\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"loan_id\",value:formData.loan_id,onChange:handleChange,placeholder:\"Loan ID\",required:true,disabled:isLoading}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",name:\"amount\",value:formData.amount,onChange:handleChange,placeholder:\"Payment Amount (\\u20B9)\",required:true,disabled:isLoading}),/*#__PURE__*/_jsxs(\"select\",{name:\"payment_type\",value:formData.payment_type,onChange:handleChange,disabled:isLoading,children:[/*#__PURE__*/_jsx(\"option\",{value:\"EMI\",children:\"EMI Payment\"}),/*#__PURE__*/_jsx(\"option\",{value:\"LUMP_SUM\",children:\"Lump Sum Payment\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:isLoading,children:isLoading?'Processing...':'Record Payment'})]}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"error\",children:error})]});}export default Payment;","map":{"version":3,"names":["React","useState","Modal","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","API_URL","Payment","formData","setFormData","loan_id","amount","payment_type","error","setError","isLoading","setIsLoading","isModalOpen","setIsModalOpen","modalContent","setModalContent","title","body","handleChange","e","name","value","target","prev","closeModalAndReset","handleSubmit","preventDefault","trim","response","fetch","method","headers","JSON","stringify","data","json","ok","toLowerCase","includes","children","Error","loan_closed","parseFloat","overpaid_amount","customer_name","toFixed","remaining_balance","err","message","isOpen","onClose","onSubmit","className","type","onChange","placeholder","required","disabled"],"sources":["C:/Users/chait/OneDrive/Desktop/Projects/bank-loan-management-system/frontend/src/components/Payment/Payment.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport './Payment.css';\r\nimport Modal from '../Modal/Modal';\r\n\r\nconst API_URL = 'http://localhost:3001/api/v1';\r\n\r\nfunction Payment() {\r\n    const [formData, setFormData] = useState({\r\n        loan_id: '',\r\n        amount: '',\r\n        payment_type: 'EMI'\r\n    });\r\n    const [error, setError] = useState('');\r\n    const [isLoading, setIsLoading] = useState(false);\r\n\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n    const [modalContent, setModalContent] = useState({ title: '', body: null });\r\n\r\n    const handleChange = (e) => {\r\n        const { name, value } = e.target;\r\n        setFormData(prev => ({ ...prev, [name]: value }));\r\n    };\r\n\r\n    const closeModalAndReset = () => {\r\n        setIsModalOpen(false);\r\n    };\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        setError('');\r\n        if (!formData.loan_id.trim() || !formData.amount.trim()) {\r\n            setError('Loan ID and Amount are required.');\r\n            return;\r\n        }\r\n\r\n        setIsLoading(true);\r\n        try {\r\n            const response = await fetch(`${API_URL}/loans/${formData.loan_id}/payments`, {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({\r\n                    amount: formData.amount,\r\n                    payment_type: formData.payment_type\r\n                })\r\n            });\r\n            const data = await response.json();\r\n\r\n            if (!response.ok) {\r\n                if (data.error && data.error.toLowerCase().includes('loan not found')) {\r\n                    setModalContent({\r\n                        title: \"Invalid Loan ID\",\r\n                        body: (\r\n                            <>\r\n                                <p>The Loan ID <strong>{formData.loan_id}</strong> is not associated with any active loan.</p>\r\n                                <p>Please check the ID and try again.</p>\r\n                            </>\r\n                        )\r\n                    });\r\n                    setIsModalOpen(true);\r\n                } else {\r\n                    throw new Error(data.error || 'Failed to record payment.');\r\n                }\r\n            } else {\r\n                if (data.loan_closed) {\r\n                    if (parseFloat(data.overpaid_amount) > 0) {\r\n                        setModalContent({\r\n                            title: \"Loan Closed & Refund Due\",\r\n                            body: <p>The loan for {data.customer_name} is fully paid. An overpayment of ₹{parseFloat(data.overpaid_amount).toFixed(2)} will be refunded.</p>\r\n                        });\r\n                    } else {\r\n                        setModalContent({\r\n                            title: \"Loan Closed!\",\r\n                            body: <p>Congratulations, {data.customer_name}! This loan has been fully paid off.</p>\r\n                        });\r\n                    }\r\n                } else {\r\n                    setModalContent({\r\n                        title: \"Payment Successful\",\r\n                        body: <p>Payment of ₹{parseFloat(formData.amount).toFixed(2)} for {data.customer_name} was successful. The new remaining balance is ₹{parseFloat(data.remaining_balance).toFixed(2)}.</p>\r\n                    });\r\n                }\r\n                setIsModalOpen(true);\r\n                setFormData({ loan_id: '', amount: '', payment_type: 'EMI' });\r\n            }\r\n        } catch (err) {\r\n            setError(err.message);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <Modal\r\n                isOpen={isModalOpen}\r\n                onClose={closeModalAndReset}\r\n                title={modalContent.title}\r\n            >\r\n                {modalContent.body}\r\n            </Modal>\r\n\r\n            \r\n\r\n            <form onSubmit={handleSubmit} className=\"form-container payment-container\">\r\n                <h2 className=\"component-title\">Record a Payment</h2>\r\n            <p className=\"component-subtitle\">Submit an EMI or a lump sum amount for an active loan.</p>\r\n                <input\r\n                    type=\"text\"\r\n                    name=\"loan_id\"\r\n                    value={formData.loan_id}\r\n                    onChange={handleChange}\r\n                    placeholder=\"Loan ID\"\r\n                    required\r\n                    disabled={isLoading}\r\n                />\r\n                <input\r\n                    type=\"number\"\r\n                    name=\"amount\"\r\n                    value={formData.amount}\r\n                    onChange={handleChange}\r\n                    placeholder=\"Payment Amount (₹)\"\r\n                    required\r\n                    disabled={isLoading}\r\n                />\r\n                <select\r\n                    name=\"payment_type\"\r\n                    value={formData.payment_type}\r\n                    onChange={handleChange}\r\n                    disabled={isLoading}\r\n                >\r\n                    <option value=\"EMI\">EMI Payment</option>\r\n                    <option value=\"LUMP_SUM\">Lump Sum Payment</option>\r\n                </select>\r\n                <button type=\"submit\" disabled={isLoading}>\r\n                    {isLoading ? 'Processing...' : 'Record Payment'}\r\n                </button>\r\n            </form>\r\n\r\n            {error && <p className=\"error\">{error}</p>}\r\n        </>\r\n    );\r\n}\r\n\r\nexport default Payment;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}